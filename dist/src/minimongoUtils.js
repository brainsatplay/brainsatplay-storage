import { CSV } from "./csv.js";
//const minimongo = require("minimongo");
//db default instantiated to local DB, preferably IndexedDB
export let db;
if (typeof minimongo !== 'undefined')
    db = localDB();
// REMOTE DB FUNCTIONALITY:
// https://github.com/mWater/minimongo#remotedb
export const localDB = (db) => {
    try {
        db = new minimongo.IndexedDb();
    }
    catch (err) {
        try {
            db = new minimongo.LocalStorageDb();
        }
        catch (err2) {
            try {
                db = new minimongo.MemoryDb();
            }
            catch (err3) {
                console.error('No DB created!');
            }
        }
    }
    return db;
};
//create a remote db
export const remoteDB = (db, url, client, httpclient, useQuickFind, usePostFind) => {
    db = new minimongo.RemoteDb(url, client, httpclient, useQuickFind, usePostFind);
    return db;
};
//replaces the input db with a hybrid db: https://github.com/mWater/minimongo#hybriddb
export const connectDB = (db, url, client, httpclient, useQuickFind, usePostFind) => {
    let remote = new minimongo.RemoteDb(url, client, httpclient, useQuickFind, usePostFind);
    db = new minimongo.HybridDb(db, remote); //locally accessible, and lazy loads from DB
    return db;
};
export const readData = async (db, collection = '', query = {}) => {
    if (!collection)
        return undefined;
    if (!db[collection])
        db.addCollection(collection);
    return await db[collection].findOne(query);
};
export const writeData = async (db, collection, data = {}, onsuccess = (doc) => { }, onerror = (err) => { }) => {
    if (!collection)
        return undefined;
    if (!db[collection])
        db.addCollection(collection);
    return await db[collection].upsert(data, onsuccess, onerror);
};
export const readFile = async (db, collection, filename = '') => {
    if (!db[collection])
        return undefined;
    let query = { filename };
    let found = db[collection].find(query);
    let ct = await found.count();
    let result;
    if (ct > 0) {
        result = [];
        await Promise.all(found.map(async (s) => {
            result.push(s); //return the file chunks or just the file
        }));
    }
    return result;
};
export const readFileChunk = async (db, collection, filename = '', chunk = undefined, start = undefined, end = undefined, onsuccess = (doc) => { }, onerror = (err) => { }, findOneOptions) => {
    if (!db[collection])
        return undefined;
    let query = { filename };
    if (chunk)
        query.chunk = chunk;
    if (start)
        query.start = start;
    if (end)
        query.end = end;
    if (!chunk && !(start && end))
        return undefined;
    return await db[collection].findOne(query, findOneOptions, onsuccess, onerror);
};
export const writeFile = async (db, collection, filename = '', data, onsuccess = (doc) => { }, onerror = (err) => { }, props = {}, filetype = 'text/plain', chunkSize = 256000) => {
    let found = db[collection].find({ filename });
    if (await found.count() > 0) {
        await Promise.all(found.map(async (s) => {
            db[collection].remove(s._id);
        }));
    }
    let file = { filename, data: new Blob([data], { filetype: filetype }) };
    Object.assign(file, props);
    if (file.data.size > chunkSize) {
        const size = file.data.size;
        let written = 0;
        let i = 0;
        while (written < size) {
            let end = written + chunkSize;
            if (end > size)
                end = size;
            let slice = undefined;
            if (filetype === 'text/plain') {
                slice = await file.data.slice(written, end).text();
            }
            else {
                slice = await file.data.slice(written, end).arrayBuffer();
            }
            if (slice) {
                let chunk = { filename, data: new Blob([slice], { type: filetype }), chunk: i, start: written, end: end };
                Object.assign(chunk, props);
                db[collection].upsert(chunk, onsuccess, onerror);
            }
            written += chunkSize;
            i++;
        }
    }
    else
        db[collection].upsert(file, onsuccess, onerror);
};
//add the chunk to the end. This is represented as different objects
export const appendFile = async (db, collection, filename = '', data, onsuccess = (doc) => { }, onerror = (err) => { }, props = {}, filetype = 'text/plain', chunkSize = 256000) => {
    let found = db[collection].find({ filename });
    let ct = await found.count();
    let size = 0;
    let file = { filename, data: new Blob([data], { filetype: filetype }) };
    Object.assign(file, props);
    if (ct > 0) {
        await Promise.all(found.map(async (s) => {
            size += s.size;
        }));
        if (file.data.size > chunkSize) {
            let written = size;
            let i = ct;
            while (written < file.data.size + size) {
                let end = written + chunkSize;
                if (end > size)
                    end = size;
                let slice = undefined;
                if (filetype === 'text/plain') {
                    slice = await file.data.slice(written, end).text();
                }
                else {
                    slice = await file.data.slice(written, end).arrayBuffer();
                }
                if (slice) {
                    let chunk = { filename, data: new Blob([slice], { type: filetype }), chunk: i, start: written, end: end, size: end - written };
                    Object.assign(chunk, props);
                    db[collection].upsert(chunk, onsuccess, onerror);
                }
                written += chunkSize;
                i++;
            }
        }
        else {
            file.chunk = ct;
            file.start = size;
            file.end = size + file.data.size;
            db[collection].upsert(file, onsuccess, onerror);
        }
    }
    else {
        db[collection].upsert(file, onsuccess, onerror);
    }
};
export const getFilenames = async (db, collection) => {
    let found = db[collection].find();
    let filenames = [];
    let ct = await found.count();
    if (ct > 0) {
        await Promise.all(found.map(async (s) => {
            if (typeof s.chunk !== 'undefined') {
                if (s.chunk === 0) {
                    filenames.push(s.filename);
                }
            }
            else
                filenames.push(s.filename);
        }));
    }
    return filenames;
};
export const listFiles = getFilenames;
export const getFileSize = async (db, collection, filename) => {
    let found = db[collection].find({ filename });
    let ct = await found.count();
    let size = 0;
    if (ct > 0) {
        await Promise.all(found.map(async (s) => {
            size += s.size;
        }));
    }
    return size;
};
export const deleteFile = async (db, collection, query) => {
    return await db[collection].remove(query);
};
export const writeToCSVFromDB = async (db, collection, filename) => {
    let text = await readFileAsText(collection, filename);
    //now save to CSV (assuming it's already processed into CSV data)
    CSV.saveCSV(text, filename);
};
export const getCSVHeader = async (db, collection, filename) => {
    let found = db[collection].find({ filename });
    let result;
    let ct = await found.count();
    if (ct > 0) {
        await Promise.all(found.map(async (s) => {
            if (typeof s.chunk !== 'undefined') {
                if (s.chunk === 0) {
                    let text = await s.data.text();
                    result = text.substring(0, text.indexOf('\n')); //get header of the text off the first slice
                }
            }
        }));
    }
    return result;
};
export const readFileAsText = async (db, collection, filename) => {
    let found = db[collection].find({ filename });
    let result;
    let ct = await found.count();
    if (ct > 0) {
        let chunks = {};
        await Promise.all(found.map(async (s) => {
            let text = await s.data.text();
            if (typeof s.chunk !== 'undefined') {
                chunks[s.chunk] = text; //get possibly unordered chunks
            }
            else
                chunks[0] = text;
        }));
        let l = Object.keys(chunks).length;
        for (let i = 0; i < l; i++) {
            result += chunks[i];
        }
    }
    return result;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWluaW1vbmdvVXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbWluaW1vbmdvVXRpbHMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUUvQix5Q0FBeUM7QUFHekMsMkRBQTJEO0FBQzNELE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUVkLElBQUcsT0FBTyxTQUFTLEtBQUssV0FBVztJQUMvQixFQUFFLEdBQUcsT0FBTyxFQUFFLENBQUM7QUFFbkIsMkJBQTJCO0FBQzNCLCtDQUErQztBQUUvQyxNQUFNLENBQUMsTUFBTSxPQUFPLEdBQUcsQ0FBQyxFQUFFLEVBQUUsRUFBRTtJQUMxQixJQUFJO1FBQ0EsRUFBRSxHQUFHLElBQUksU0FBUyxDQUFDLFNBQVMsRUFBRSxDQUFBO0tBQ2pDO0lBQUMsT0FBTSxHQUFHLEVBQUU7UUFDVCxJQUFJO1lBQ0EsRUFBRSxHQUFHLElBQUksU0FBUyxDQUFDLGNBQWMsRUFBRSxDQUFBO1NBQ3RDO1FBQUMsT0FBTyxJQUFJLEVBQUU7WUFDWCxJQUFJO2dCQUNBLEVBQUUsR0FBRyxJQUFJLFNBQVMsQ0FBQyxRQUFRLEVBQUUsQ0FBQzthQUNqQztZQUFDLE9BQU8sSUFBSSxFQUFFO2dCQUNYLE9BQU8sQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsQ0FBQzthQUNuQztTQUNKO0tBQ0o7SUFDRCxPQUFPLEVBQUUsQ0FBQztBQUNkLENBQUMsQ0FBQTtBQUVELG9CQUFvQjtBQUNwQixNQUFNLENBQUMsTUFBTSxRQUFRLEdBQUcsQ0FBQyxFQUFFLEVBQUMsR0FBRyxFQUFDLE1BQU0sRUFBQyxVQUFVLEVBQUMsWUFBWSxFQUFDLFdBQVcsRUFBRSxFQUFFO0lBQzFFLEVBQUUsR0FBRyxJQUFJLFNBQVMsQ0FBQyxRQUFRLENBQUMsR0FBRyxFQUFDLE1BQU0sRUFBQyxVQUFVLEVBQUMsWUFBWSxFQUFDLFdBQVcsQ0FBQyxD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