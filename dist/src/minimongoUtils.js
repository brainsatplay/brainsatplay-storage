import { CSV } from "./csv.js";
const minimongo = require("minimongo");
//db default instantiated to local DB, preferably IndexedDB
export let db;
db = localDB();
// REMOTE DB FUNCTIONALITY:
// https://github.com/mWater/minimongo#remotedb
export const localDB = (db) => {
    try {
        db = new minimongo.IndexedDb();
    }
    catch (err) {
        try {
            db = new minimongo.LocalStorageDb();
        }
        catch (err2) {
            try {
                db = new minimongo.MemoryDb();
            }
            catch (err3) {
                console.error('No DB created!');
            }
        }
    }
    return db;
};
//create a remote db
export const remoteDB = (db, url, client, httpclient, useQuickFind, usePostFind) => {
    db = new minimongo.RemoteDb(url, client, httpclient, useQuickFind, usePostFind);
    return db;
};
//replaces the input db with a hybrid db: https://github.com/mWater/minimongo#hybriddb
export const connectDB = (db, url, client, httpclient, useQuickFind, usePostFind) => {
    let remote = new minimongo.RemoteDb(url, client, httpclient, useQuickFind, usePostFind);
    db = new minimongo.HybridDb(db, remote); //locally accessible, and lazy loads from DB
    return db;
};
export const readData = async (db, collection = '', query = {}) => {
    if (!collection)
        return undefined;
    if (!db[collection])
        db.addCollection(collection);
    return await db[collection].findOne(query);
};
export const writeData = async (db, collection, data = {}, onsuccess = (doc) => { }, onerror = (err) => { }) => {
    if (!collection)
        return undefined;
    if (!db[collection])
        db.addCollection(collection);
    return await db[collection].upsert(data, onsuccess, onerror);
};
export const readFile = async (db, collection, filename = '') => {
    if (!db[collection])
        return undefined;
    let query = { filename };
    let found = db[collection].find(query);
    let ct = await found.count();
    let result;
    if (ct > 0) {
        result = [];
        await Promise.all(found.map(async (s) => {
            result.push(s); //return the file chunks or just the file
        }));
    }
    return result;
};
export const readFileChunk = async (db, collection, filename = '', chunk = undefined, start = undefined, end = undefined, onsuccess = (doc) => { }, onerror = (err) => { }, findOneOptions) => {
    if (!db[collection])
        return undefined;
    let query = { filename };
    if (chunk)
        query.chunk = chunk;
    if (start)
        query.start = start;
    if (end)
        query.end = end;
    if (!chunk && !(start && end))
        return undefined;
    return await db[collection].findOne(query, findOneOptions, onsuccess, onerror);
};
export const writeFile = async (db, collection, filename = '', data, onsuccess = (doc) => { }, onerror = (err) => { }, props = {}, filetype = 'text/plain', chunkSize = 256000) => {
    let found = db[collection].find({ filename });
    if (await found.count() > 0) {
        await Promise.all(found.map(async (s) => {
            db[collection].remove(s._id);
        }));
    }
    let file = { filename, data: new Blob([data], { filetype: filetype }) };
    Object.assign(file, props);
    if (file.data.size > chunkSize) {
        const size = file.data.size;
        let written = 0;
        let i = 0;
        while (written < size) {
            let end = written + chunkSize;
            if (end > size)
                end = size;
            let slice = undefined;
            if (filetype === 'text/plain') {
                slice = await file.data.slice(written, end).text();
            }
            else {
                slice = await file.data.slice(written, end).arrayBuffer();
            }
            if (slice) {
                let chunk = { filename, data: new Blob([slice], { type: filetype }), chunk: i, start: written, end: end };
                Object.assign(chunk, props);
                db[collection].upsert(chunk, onsuccess, onerror);
            }
            written += chunkSize;
            i++;
        }
    }
    else
        db[collection].upsert(file, onsuccess, onerror);
};
//add the chunk to the end. This is represented as different objects
export const appendFile = async (db, collection, filename = '', data, onsuccess = (doc) => { }, onerror = (err) => { }, props = {}, filetype = 'text/plain', chunkSize = 256000) => {
    let found = db[collection].find({ filename });
    let ct = await found.count();
    let size = 0;
    let file = { filename, data: new Blob([data], { filetype: filetype }) };
    Object.assign(file, props);
    if (ct > 0) {
        await Promise.all(found.map(async (s) => {
            size += s.size;
        }));
        if (file.data.size > chunkSize) {
            let written = size;
            let i = ct;
            while (written < file.data.size + size) {
                let end = written + chunkSize;
                if (end > size)
                    end = size;
                let slice = undefined;
                if (filetype === 'text/plain') {
                    slice = await file.data.slice(written, end).text();
                }
                else {
                    slice = await file.data.slice(written, end).arrayBuffer();
                }
                if (slice) {
                    let chunk = { filename, data: new Blob([slice], { type: filetype }), chunk: i, start: written, end: end, size: end - written };
                    Object.assign(chunk, props);
                    db[collection].upsert(chunk, onsuccess, onerror);
                }
                written += chunkSize;
                i++;
            }
        }
        else {
            file.chunk = ct;
            file.start = size;
            file.end = size + file.data.size;
            db[collection].upsert(file, onsuccess, onerror);
        }
    }
    else {
        db[collection].upsert(file, onsuccess, onerror);
    }
};
export const getFilenames = async (db, collection) => {
    let found = db[collection].find();
    let filenames = [];
    let ct = await found.count();
    if (ct > 0) {
        await Promise.all(found.map(async (s) => {
            if (typeof s.chunk !== 'undefined') {
                if (s.chunk === 0) {
                    filenames.push(s.filename);
                }
            }
            else
                filenames.push(s.filename);
        }));
    }
    return filenames;
};
export const listFiles = getFilenames;
export const getFileSize = async (db, collection, filename) => {
    let found = db[collection].find({ filename });
    let ct = await found.count();
    let size = 0;
    if (ct > 0) {
        await Promise.all(found.map(async (s) => {
            size += s.size;
        }));
    }
    return size;
};
export const deleteFile = async (db, collection, query) => {
    return await db[collection].remove(query);
};
export const writeToCSVFromDB = async (db, collection, filename) => {
    let text = await readFileAsText(collection, filename);
    //now save to CSV (assuming it's already processed into CSV data)
    CSV.saveCSV(text, filename);
};
export const getCSVHeader = async (db, collection, filename) => {
    let found = db[collection].find({ filename });
    let result;
    let ct = await found.count();
    if (ct > 0) {
        await Promise.all(found.map(async (s) => {
            if (typeof s.chunk !== 'undefined') {
                if (s.chunk === 0) {
                    let text = await s.data.text();
                    result = text.substring(0, text.indexOf('\n')); //get header of the text off the first slice
                }
            }
        }));
    }
    return result;
};
export const readFileAsText = async (db, collection, filename) => {
    let found = db[collection].find({ filename });
    let result;
    let ct = await found.count();
    if (ct > 0) {
        let chunks = {};
        await Promise.all(found.map(async (s) => {
            let text = await s.data.text();
            if (typeof s.chunk !== 'undefined') {
                chunks[s.chunk] = text; //get possibly unordered chunks
            }
            else
                chunks[0] = text;
        }));
        let l = Object.keys(chunks).length;
        for (let i = 0; i < l; i++) {
            result += chunks[i];
        }
    }
    return result;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWluaW1vbmdvVXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbWluaW1vbmdvVXRpbHMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUUvQixNQUFNLFNBQVMsR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7QUFHdkMsMkRBQTJEO0FBQzNELE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUNkLEVBQUUsR0FBRyxPQUFPLEVBQUUsQ0FBQztBQUVmLDJCQUEyQjtBQUMzQiwrQ0FBK0M7QUFFL0MsTUFBTSxDQUFDLE1BQU0sT0FBTyxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUU7SUFDMUIsSUFBSTtRQUNBLEVBQUUsR0FBRyxJQUFJLFNBQVMsQ0FBQyxTQUFTLEVBQUUsQ0FBQTtLQUNqQztJQUFDLE9BQU0sR0FBRyxFQUFFO1FBQ1QsSUFBSTtZQUNBLEVBQUUsR0FBRyxJQUFJLFNBQVMsQ0FBQyxjQUFjLEVBQUUsQ0FBQTtTQUN0QztRQUFDLE9BQU8sSUFBSSxFQUFFO1lBQ1gsSUFBSTtnQkFDQSxFQUFFLEdBQUcsSUFBSSxTQUFTLENBQUMsUUFBUSxFQUFFLENBQUM7YUFDakM7WUFBQyxPQUFPLElBQUksRUFBRTtnQkFDWCxPQUFPLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLENBQUM7YUFDbkM7U0FDSjtLQUNKO0lBQ0QsT0FBTyxFQUFFLENBQUM7QUFDZCxDQUFDLENBQUE7QUFFRCxvQkFBb0I7QUFDcEIsTUFBTSxDQUFDLE1BQU0sUUFBUSxHQUFHLENBQUMsRUFBRSxFQUFDLEdBQUcsRUFBQyxNQUFNLEVBQUMsVUFBVSxFQUFDLFlBQVksRUFBQyxXQUFXLEVBQUUsRUFBRTtJQUMxRSxFQUFFLEdBQUcsSUFBSSxTQUFTLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBQyxNQUFNLEVBQUMsVUFBVSxFQUFDLFlBQVksRUFBQyxXQUFXLENBQUMs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